# О туториале
В этом туториале мы будем создавать бота шаг за шагом, и узнаем все, 
как использовать все возможности платформы для создания ботов любой
сложности.

(Туториал в процессе создания)

# Часть 1. Повторюшка

В первой части туториала мы создадим бота, который умеет дублировать
сообщения пользователей.

Пример:

>Вы: привет, как дела?
>
>Бот: привет, как дела?
>
>Вы: у меня хорошо
>
>Бот: у меня хорошо

## Регистрация

Мы будем создавать бота для Телеграма, поэтому,
перед тем как начать, нам нужно зарегистрировать бота
в мессенджере. Следуйте инструкциям ниже:

1. Откройте чат с [@BotFather](https://web.telegram.org/#/im?p=@BotFather)
и введите команду `/start` если общаетесь с ним впервые
1. Введите команду `/newbot` и ответьте на все вопросы бота
"Отца".
1. Он спросит вас как его назвать, спросит каким будет его
идентификатор.
1. Когда все будет готово у вас будет токен, похожий на
`233259927:AAGIO9DeOK4EeIj4MdybEA3mllrxufHjoAE` - сохраните его.

## Первые шаги

Сейчас мы создадим вашу первую конфигурацию, вдохните глубже,
с этого дня мир никогда не будет таким как прежде...

1. Откройте ваш любимый текстовый редактор. Будет прекрасно
если он умеет подсвечивать синтаксис **YAML**.
1. Создайте новый документ. Перед тем, как приступить к
туториалу, изучите синтаксис **YAML**. Можно здесь:
[синтаксис на википедии](https://ru.wikipedia.org/wiki/YAML)
1. И, первое, что надо прописать в нем — токен вашего бота.

```
# Отметим по спецификациям YAML начало потока
---
  # В секции "bots" мы описываем в каких мессенджерах работает бот, и его данные
  # авторизации, например для Телеграма это token
  bots:
    telegram:
      token: 233259927:AAGIO9DeOK4EeIj4MdybEA3mllrxufHjoAE
```

С авторизацией покончено. Теперь можно научить бота чему-нибудь полезному.

Научим его реагировать на самую первую команду `/start`

Будем использовать один из самых простых *api* - *simple api*.
Simple api позволяет описывать простые реакции на входящие события вида *запрос → ответ.*

Опишем конфигурацию для данного api, которое назовем **echoer**

```
  # В секции api мы создаем различные сервисы для бота, их может быть несколько
  api:
    # Зададим имя для api: "echoer"
    echoer:
      # Укажем, что в качестве сервиса мы выбираем "simple" - простой ввод/вывод
      # на данный момент есть выбор из трех сервисов: simple, fsm и http.
      service: simple
      # Укажем, какие должны быть "actions"
      # actions - это те элементы, которые будут выводиться пользователю.
      # У каждого экшена должно быть задано имя, по этому имени его можно
      # вызывать из конфигурации команд
      actions:
        # имя action - "hello"
        # каждый action это список, содержащий в себе разные элементы
        # в данном случае - простой текст
        hello:
          # тип элемента - "text", и аттрибут - "answer",
          # в котором содержится ответ пользователю.
          - type: text
            answer: Привет, это туториал бот для платформы BaaS. Пишите ему что хотите, а он будет повторять это
      # Укажем, какие должны обрабатываться команды
      # Команды — это слова, начинающиейся с "/" (в телеграме)
      commands:
        # Означает, что бот будет реагировать на команду "/start"
        start:
          # Здесь перечисляются экшены по именам (все экшены мы задали выше)
          actions:
            # Опишем, что выводить пользователю нужно экшен под именем "hello"
            - hello
```

## Повтор сообщений

А теперь, давайте заставим его повторять все, что мы ему написали.

Для этого добавим ему еще один action, который назовем "echo".
Именно этот action и будет возвращать текст сообщения обратно.
Будем использовать внутреннюю переменную платформы - `$text`

```
        # имя action - "echo"
        echo:
          # Интересным моментом здесь является то, что в ответ пользователю возвращается его же
          # сообщение, это возможно благодаря тому, что платформа BaaS сохраняет все сообщения
          # приходящих боту в переменную $text
          # Практически везде можно использовать различные переменные, комбинировать их, производить над ними
          # различные операции.
          - type: text
            answer: $text
```

Также нам нужно добавить обработчик сообщений, он аналогичен
`commands` и называется `messages`. В этом обработчике, мы будем
перехватывать все сообщения, которые придут, благодаря
тому, что в качестве фильтра, мы используем специальное слово
`any`.

```
      # В данной секции обрабатываются сообщения, пока что перехватывать можно либо точные совпадения,
      # либо все сообщения без разбора. В будущем появится возможность использовать фильтры.
      # Сейчас мы используем втроенную возможность перехватывать все сообщения - "any"
      messages:
        # Перехватим все сообщения
        any:
          # Будем отфутболивать обратно любое сообщение, для этого воспользуемся предварительно описанным
          # экшеном - "echo"
          actions:
            # Экшен, который умеет дублировать сообщения
            - echo
```

В итоге у нас получилась такая конфигурация:

```
# Отметим по спецификациям YAML начало потока
---

  # В секции "bots" мы описываем в каких мессенджерах работает бот, и его данные
  # авторизации, например для Телеграма это token
  bots:
    telegram:
      token: 233259927:AAGIO9DeOK4EeIj4MdybEA3mllrxufHjoAE

  # В секции api мы создаем различные сервисы для бота, их может быть несколько
  api:
    # Зададим имя для api: "echoer"
    echoer:
      # Укажем, что в качестве сервиса мы выбираем "simple" - простой ввод/вывод
      # на данный момент есть выбор из трех сервисов: simple, fsm и http.
      service: simple
      # Укажем, какие должны быть "actions"
      # actions - это те элементы, которые будут выводиться пользователю.
      # У каждого экшена должно быть задано имя, по этому имени его можно
      # вызывать из конфигурации команд
      actions:
        # имя action - "hello"
        # каждый action это список, содержащий в себе разные элементы
        # в данном случае - простой текст
        hello:
          # тип элемента - "text", и аттрибут - "answer",
          # в котором содержится ответ пользователю.
          - type: text
            answer: Привет, это туториал бот для платформы BaaS. Пишите ему что хотите, а он будет повторять это
        # имя action - "echo"
        echo:
          # Интересным моментом здесь является то, что в ответ пользователю возвращается его же
          # сообщение, это возможно благодаря тому, что платформа BaaS сохраняет все сообщения
          # приходящих боту в переменную $text
          # Практически везде можно использовать различные переменные, комбинировать их, производить над ними
          # различные операции.
          - type: text
            answer: $text
      # Укажем, какие должны обрабатываться команды
      # Команды — это слова, начинающиейся с "/" (в телеграме)
      commands:
        # Означает, что бот будет реагировать на команду "/start"
        start:
          # Здесь перечисляются экшены по именам (все экшены мы задали выше)
          actions:
            # Опишем, что выводить пользователю нужно экшен под именем "hello"
            - hello
      # В данной секции обрабатываются сообщения, пока что перехватывать можно либо точные совпадения,
      # либо все сообщения без разбора. В будущем появится возможность использовать фильтры.
      # Сейчас мы используем втроенную возможность перехватывать все сообщения - "any"
      messages:
        # Перехватим все сообщения
        any:
          # Будем отфутболивать обратно любое сообщение, для этого воспользуемся предварительно описанным
          # экшеном - "echo"
          actions:
            # Экшен, который умеет дублировать сообщения
            - echo
```

Загрузите эту конфигурацию, используя бот [@baas_main_manager_bot](https://web.telegram.org/#/im?p=@baas_main_manager_bot)
(у вас должен быть к нему доступ)

Не забудьте активировать вебхук.

# Часть 2

Мы разобрались, как создать простейшего бота. Теперь давайте научим его
чему-нибудь более интересному.

